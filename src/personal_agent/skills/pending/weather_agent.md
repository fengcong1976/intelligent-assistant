# 天气查询智能体

name: weather_agent  
description: 一个支持单城市实时天气查询、多城市天气对比及个性化穿衣建议的轻量级天气智能体，基于权威气象数据源提供准确、实用的出行生活参考。

## Capabilities  
- 查询当前天气：获取指定城市当前温度、湿度、风速、气压、能见度、天气现象（如晴/雨/雪）及空气质量指数（AQI）  
- 多城市对比：支持同时输入2–5个城市，以表格形式横向对比关键天气指标（温度、体感温度、湿度、风速、天气状况、AQI）  
- 智能穿衣建议：根据当前城市实况温度、湿度、风速、降水概率及紫外线强度，结合季节与用户所在地区气候特征，生成分层建议（外搭、内衬、配饰）及风险提示（如防滑、防晒、保暖）  
- 城市自动纠错与补全：对模糊/错别字城市名（如“北就”“上嗨”）进行语义识别与标准化映射，支持区县级粒度（如“杭州市西湖区”）  

## Keywords  
- 天气  
- 今天天气怎么样  
- XX市天气  
- 对比北京和上海天气  
- 去深圳穿什么合适  
- 明天出门要带伞吗  
- 穿衣建议  

## How to use  
### 1. 单城市天气查询  
用户输入示例: “查一下广州现在的天气”  
参数:  
- city: 字符串，必填；支持中文城市名（含直辖市、地级市、自治州、特别行政区），可带“市/区/县”后缀（如“成都市”“朝阳区”）  

### 2. 多城市天气对比  
用户输入示例: “对比杭州、南京、合肥今天的天气”  
参数:  
- cities: 字符串数组，长度2–5，必填；每个元素为标准城市名，按输入顺序排列  

### 3. 获取穿衣建议  
用户输入示例: “上海现在穿什么合适？” 或 “去西安旅游明天怎么穿”  
参数:  
- city: 字符串，必填；目标城市名  
- date: 字符串，可选；默认为“today”，支持“tomorrow”或ISO格式日期（如“2024-06-15”）  
- context: 字符串，可选；补充场景（如“户外徒步”“通勤上班”“儿童出行”），用于细化建议  

## Edge Cases  
1. 情况：城市名不存在或无法识别（如“火星市”“不存在的小镇”）→ 返回友好提示：“未找到‘XXX’的天气数据，请确认城市名称是否正确，或尝试输入更常见的简称（如‘京’‘沪’）。”并推荐3个相似候选城市。  
2. 情况：多城市请求中存在无效城市（如混合有效/无效名称）→ 自动过滤无效项，仅对比剩余有效城市，并明确告知：“已忽略无法识别的城市：XXX；正在对比以下X个城市：[A, B, C]。”  
3. 情况：用户未提供城市但询问穿衣建议（如“我该穿什么？”）→ 主动追问：“请问您所在的城市是？或者您计划前往哪个城市？”并支持后续上下文续问。  
4. 情况：极端天气（如台风红色预警、暴雪橙色预警）→ 在天气详情末尾添加❗️强提醒图标及简明避险指引（如“请避免外出”“注意防风加固”），不依赖用户主动提问。  

## Implementation Notes  
1. 数据源需对接至少两个合规气象API（如中国气象局官方接口 + 和风天气/心知天气商用版），实现主备切换与数据融合校验，确保温度、AQI等关键字段误差≤0.5℃/5点。  
2. 穿衣建议模型采用规则引擎+轻量级决策树：基础层依据《GB/T 33675-2017 气候舒适度等级》计算体感温度；增强层引入本地化经验规则（如南方湿冷增重1–2层、北方干冷强调防风），避免纯LLM幻觉。  
3. 多城市对比结果必须结构化输出：统一使用Markdown表格，列头固定为【城市｜温度｜体感温度｜天气｜湿度｜风速｜AQI】，缺失数据标“—”，数值单位统一（℃、%、m/s、无量纲）。  
4. 所有城市名解析需调用内置地理编码缓存库（预载全国333个地级行政区及主要城区），首次查询失败时触发实时高德/百度地图API反向地理编码，响应延迟控制在800ms内。  
5. 隐私安全：不存储用户位置历史；城市名仅用于本次请求，禁止上传原始输入至第三方LLM；AQI等敏感数据展示前需脱敏（如显示“良”而非具体数值，除非用户明确要求）。