---
name: send_email
description: 发送邮件工具，支持附件、自动生成内容、格式化称呼和署名
version: 1.0.0
---

# 邮件发送工具

## 功能说明
本工具用于发送邮件，支持以下功能：
- 自动生成邮件主题和正文（基于用户描述）
- 格式化邮件内容（自动添加称呼和署名）
- 支持添加附件（单个或多个文件）
- 智能识别收件人（支持联系人名称或邮箱地址）
- 区分发送给自己/他人的不同格式
- 自动修正邮件内容（去除多余称呼，添加标准署名）

## 参数说明

### 必需参数
- `to`: 收件人邮箱地址或联系人名称
  - 类型：string
  - 示例："zhangsan@example.com" 或 "张三"
  - 说明：如果提供联系人名称，会自动从通讯录查找邮箱

### 可选参数
- `subject`: 邮件主题
  - 类型：string
  - 示例："项目进度汇报"
  - 说明：如果不提供，会根据邮件内容自动生成

- `content`: 邮件正文
  - 类型：string
  - 示例："附件是本周的项目进度报告，请查收。"
  - 说明：如果不提供，会根据用户描述自动生成

- `recipient_name`: 收件人姓名
  - 类型：string
  - 示例："张三"
  - 说明：用于邮件称呼，如果to是邮箱地址，可以额外提供姓名

- `attachments`: 附件列表
  - 类型：array
  - 示例：["C:/Users/xxx/report.pdf", "C:/Users/xxx/data.xlsx"]
  - 说明：支持绝对路径或相对路径

- `attachment`: 单个附件路径（简化参数）
  - 类型：string
  - 示例："C:/Users/xxx/report.pdf"
  - 说明：与attachments二选一，优先使用attachments

## 使用场景

### 场景1：发送简单邮件
```
用户："发邮件给张三，告诉他明天下午2点开会"
LLM理解：需要发送邮件
调用：send_email(to="张三", content="明天下午2点开会")
```

### 场景2：发送带附件的邮件
```
用户："把这个文件发给我"
（用户已拖入文件：C:/Users/xxx/report.pdf）
LLM理解：需要发送带附件的邮件给自己
调用：send_email(to="我", attachments=["C:/Users/xxx/report.pdf"])
```

### 场景3：生成并发送邮件
```
用户："写一份开工大吉的邮件发给小聪聪"
LLM理解：需要生成邮件内容并发送
调用：send_email(to="小聪聪", content="开工大吉...")
```

### 场景4：发送到自己的邮箱
```
用户："发到我邮箱"
LLM理解：发送给用户自己
调用：send_email(to="我")
```

## 邮件格式规则

### 发送给自己的邮件
- **称呼**：使用用户昵称（如"用户"）
- **署名**：仅智能体名称（如"小丽"）
- **示例**：
  ```
  用户，

  请查收附件：report.pdf

  小丽
  ```

### 发送给他人的邮件
- **称呼**：使用收件人姓名或"您"
- **署名**：使用"用户的智能助理 - 智能体名称"（如"用户的智能助理 - 小丽"）
- **示例**：
  ```
  张三，

  请查收附件：report.pdf

  用户的智能助理 - 小丽
  ```

## 注意事项

### 1. 邮箱配置
- 需要先在设置中配置SMTP服务器信息
- 包括：SMTP服务器、端口、邮箱、授权码
- 如果未配置，会提示用户配置

### 2. 收件人识别
- 支持邮箱地址：直接发送
- 支持联系人名称：从通讯录查找邮箱
- 如果找不到联系人邮箱，会提示用户

### 3. 附件处理
- 支持绝对路径和相对路径
- 会自动搜索常见目录（当前目录、output/pdf、output等）
- 如果文件不存在，会给出警告
- 附件会自动添加到邮件正文中

### 4. 内容自动修正
- 自动去除"亲爱的"、"敬爱的"、"尊敬的"等称呼
- 自动添加正确的称呼（收件人姓名或"您"）
- 自动添加标准署名
- 自动去除重复的署名

### 5. 假邮箱和假附件检测
- 自动忽略@example.com、@test.com等假邮箱
- 自动忽略/path/、[附件]等假附件路径
- 避免LLM生成虚假信息

## 常见问题

### Q1：如何发送给多个收件人？
A：当前版本只支持单个收件人。如需发送给多人，请多次调用send_email。

### Q2：附件大小有限制吗？
A：受SMTP服务器限制，通常单个附件不超过25MB。如需发送大文件，建议使用云盘链接。

### Q3：如何发送HTML格式邮件？
A：当前版本只支持纯文本邮件。HTML邮件功能将在后续版本中添加。

### Q4：邮件发送失败怎么办？
A：检查以下几点：
1. SMTP配置是否正确
2. 网络连接是否正常
3. 授权码是否有效（不是登录密码）
4. 收件人邮箱地址是否正确

## 示例对话

### 示例1：简单邮件
```
用户：帮我发邮件给张三，告诉他明天下午2点开会
系统：调用send_email(to="张三", content="明天下午2点开会")
结果：✅ 邮件已发送给 zhangsan@example.com
```

### 示例2：带附件
```
用户：把这个文件发给我
系统：检测到附件 C:/Users/xxx/report.pdf
系统：调用send_email(to="我", attachments=["C:/Users/xxx/report.pdf"])
结果：✅ 邮件已发送给 user@example.com
```

### 示例3：生成邮件
```
用户：写一份开工大吉的邮件发给小聪聪
系统：调用send_email(to="小聪聪", content="开工大吉...")
系统：自动生成邮件主题"开工大吉"
结果：✅ 邮件已发送给 xiaocongcong@example.com
```

## 相关工具
- `query_tools`: 查询可用工具
- `contact_lookup`: 查找联系人信息
- `save_document`: 保存文档（可作为邮件附件）